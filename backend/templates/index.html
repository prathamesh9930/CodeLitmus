<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeLitmus - Code Quality Analyzer üß™</title>
    <link rel="stylesheet" href="/static/style.css?v=2">
    <style>
        .main-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            width: 100%;
            max-width: 1400px;
        }
        
        .analyze-container {
            flex: 0 0 350px;
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }
        
        .analyze-container h2 {
            margin-bottom: 20px;
            color: #27ae60;
        }
        
        #result {
            flex: 1;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            text-align: left;
            min-height: 400px;
        }
        
        #result h2 {
            text-align: center;
            margin-bottom: 15px;
        }
        
        #result ul {
            list-style-type: none;
            padding: 0;
        }
        
        #result li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .error {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
        }
        
        .metrics-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .metric-item {
            flex: 1;
            min-width: 200px;
        }
        
        .improvement-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .improvement-item {
            background: rgba(231, 76, 60, 0.2);
            padding: 10px 15px;
            border-radius: 20px;
            color: #e67e22;
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>üß™ CodeLitmus - Code Quality Analyzer</h1>
            <button id="darkModeToggle" title="Toggle dark/light mode" style="background: #222; color: #fff; border-radius: 20px; padding: 8px 18px; font-size: 16px; border: none; cursor: pointer;">üåô Dark Mode</button>
        </div>
        <div class="main-content">
            <div class="analyze-container">
                <h2>Analyze Code Quality</h2>
                <div id="dropArea" class="drop-area" title="Drag and drop your code file here or click to select">
                    <input type="file" id="codeFile" accept=".py,.js,.ts,.java,.cpp,.c,.cs" required style="display:none;">
                    <p id="dropText">Drop file here or click to select</p>
                </div>
                <button onclick="analyzeCode()" title="Analyze the selected code file">Analyze Code</button>
            </div>
            <div id="result"></div>
        </div>
        <div id="spinner" class="spinner" style="display:none;"></div>
    </div>
    
    <script>
        // Drag-and-drop upload logic
        const dropArea = document.getElementById('dropArea');
        const codeFileInput = document.getElementById('codeFile');
        const dropText = document.getElementById('dropText');
        dropArea.addEventListener('click', () => codeFileInput.click());
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('highlight');
            dropText.textContent = 'Release to upload';
        });
        dropArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropArea.classList.remove('highlight');
            dropText.textContent = 'Drop file here or click to select';
        });
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('highlight');
            dropText.textContent = 'File selected!';
            codeFileInput.files = e.dataTransfer.files;
        });
        codeFileInput.addEventListener('change', () => {
            dropText.textContent = codeFileInput.files.length ? 'File selected!' : 'Drop file here or click to select';
        });

        // Dark mode toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            darkModeToggle.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        });

        // Spinner logic
        function showSpinner(show) {
            document.getElementById('spinner').style.display = show ? 'block' : 'none';
        }

        async function analyzeCode() {
            const file = document.getElementById('codeFile').files[0];
            if (!file) {
                document.getElementById("result").innerHTML = '<p class="error">Please select a file first.</p>';
                return;
            }
            const formData = new FormData();
            formData.append("file", file);
            try {
                showSpinner(true);
                document.getElementById("result").innerHTML = '';
                const res = await fetch("/analyze/", {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                showSpinner(false);
                if (res.ok) {
                    const verdictColor = data.verdict === 'Basic' ? '#27ae60' : data.verdict === 'Neutral' ? '#f39c12' : '#e74c3c';
                    let goodPointsHtml = '';
                    if (data.detailed_feedback.good_points.length > 0) {
                        goodPointsHtml = `
                            <div class="result-card good-card">
                                <h3>‚úÖ Strengths of Your Code</h3>
                                <ul>${data.detailed_feedback.good_points.map(point => `<li>‚Ä¢ ${point}</li>`).join('')}</ul>
                            </div>
                        `;
                    }
                    let improvementHtml = '';
                    if (data.detailed_feedback.areas_for_improvement.length > 0) {
                        improvementHtml = `
                            <div class="result-card improve-card">
                                <h3>üîß Areas for Improvement</h3>
                                <div class="improvement-grid">${data.detailed_feedback.areas_for_improvement.map(point => `<div class="improvement-item">‚Ä¢ ${point}</div>`).join('')}</div>
                            </div>
                        `;
                    }
                    let metricsHtml = '';
                    if (data.detailed_feedback.metrics_explanation) {
                        metricsHtml = `
                            <div class="result-card metrics-card">
                                <h3>üìä Detailed Metrics Analysis</h3>
                                <div class="metrics-row">
                                    <div class="metric-item"><strong>üîÑ Complexity:</strong> ${data.detailed_feedback.metrics_explanation.complexity}</div>
                                    <div class="metric-item"><strong>üîß Maintainability:</strong> ${data.detailed_feedback.metrics_explanation.maintainability}</div>
                                    <div class="metric-item"><strong>üí¨ Comments:</strong> ${data.detailed_feedback.metrics_explanation.comments}</div>
                                </div>
                            </div>
                        `;
                    }
                    document.getElementById("result").innerHTML = `
                        <div style="background: rgba(255, 255, 255, 0.08); color: white; padding: 20px; margin: 20px 0; border: 3px solid ${verdictColor}; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); backdrop-filter: blur(10px);">
                            <h1 style="font-size: 2.5em; color: ${verdictColor}; margin: 0 0 15px 0; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">üß™ VERDICT: ${data.verdict}</h1>
                            <p style="font-size: 1.4em; color: #f0f0f0; text-align: center; margin: 10px 0; font-weight: 500; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">${data.verdict_explanation}</p>
                            <p style="font-size: 1.6em; color: #f0f0f0; text-align: center; margin: 15px 0; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">üìä OVERALL SCORE: <span style="background: ${verdictColor}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 1.2em; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">${data.score}/3</span></p>
                        </div>
                        ${goodPointsHtml}
                        ${improvementHtml}
                        ${metricsHtml}
                        <div class="result-card summary-card">
                            <h3>üìã Quick Summary</h3>
                            <ul>${data.feedback && data.feedback.length ? data.feedback.map(f => `<li>‚Ä¢ ${f}</li>`).join('') : '<li>No summary available.</li>'}</ul>
                        </div>
                    `;
                } else {
                    document.getElementById("result").innerHTML = `<p class="error">Error: ${data.error}</p>`;
                }
            } catch (error) {
                showSpinner(false);
                document.getElementById("result").innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }
    </script>
    </script>
</body>
</html>
